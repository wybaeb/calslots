#!/bin/bash

# –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è Mac Calendar Free Slots Finder

echo "üóìÔ∏è  Mac Calendar Free Slots Finder - –£—Å—Ç–∞–Ω–æ–≤–∫–∞"
echo "================================================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ macOS
if [[ "$(uname)" != "Darwin" ]]; then
    echo "‚ùå –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ macOS"
    exit 1
fi

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Homebrew
install_homebrew() {
    echo "üç∫ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    
    # –î–æ–±–∞–≤–ª—è–µ–º Homebrew –≤ PATH –¥–ª—è Apple Silicon Macs
    if [[ -f "/opt/homebrew/bin/brew" ]]; then
        echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
        eval "$(/opt/homebrew/bin/brew shellenv)"
    fi
    
    # –î–ª—è Intel Macs
    if [[ -f "/usr/local/bin/brew" ]]; then
        echo 'eval "$(/usr/local/bin/brew shellenv)"' >> ~/.zprofile  
        eval "$(/usr/local/bin/brew shellenv)"
    fi
}

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Homebrew
if ! command -v brew &> /dev/null; then
    echo "üç∫ Homebrew –Ω–µ –Ω–∞–π–¥–µ–Ω"
    echo "üí° Homebrew - —ç—Ç–æ –ø–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è macOS, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–æ—Å—Ç–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É Python"
    echo ""
    read -p "–•–æ—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Homebrew? (y/n): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        install_homebrew
        if [ $? -eq 0 ]; then
            echo "‚úÖ Homebrew —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
        else
            echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Homebrew"
            echo "üí° –í—ã –º–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python –≤—Ä—É—á–Ω—É—é —Å https://python.org"
            exit 1
        fi
    else
        echo "üí° –ë–µ–∑ Homebrew —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—É–¥–µ—Ç —Å–ª–æ–∂–Ω–µ–µ"
        echo "üí° –í—ã –º–æ–∂–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python –≤—Ä—É—á–Ω—É—é —Å https://python.org"
        echo "üí° –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–∑–∂–µ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Homebrew"
        exit 1
    fi
else
    echo "‚úÖ Homebrew –Ω–∞–π–¥–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Python
if ! command -v python3 &> /dev/null; then
    echo "üêç Python 3 –Ω–µ –Ω–∞–π–¥–µ–Ω"
    echo "üí° Python –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è —Ä–∞–±–æ—Ç—ã Calendar Slots"
    echo ""
    read -p "–•–æ—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python —á–µ—Ä–µ–∑ Homebrew? (y/n): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "üîß –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é Python..."
        brew install python3
        if [ $? -eq 0 ]; then
            echo "‚úÖ Python —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
        else
            echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Python"
            exit 1
        fi
    else
        echo "‚ùå Python –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
        echo "üí° –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python —Å https://python.org –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞"
        exit 1
    fi
fi

echo "‚úÖ Python –Ω–∞–π–¥–µ–Ω: $(python3 --version)"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ pip
if ! command -v pip3 &> /dev/null; then
    echo "üì¶ pip –Ω–µ –Ω–∞–π–¥–µ–Ω"
    echo "üí° pip –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Python"
    echo ""
    read -p "–•–æ—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pip? (y/n): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "üîß –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é pip..."
        python3 -m ensurepip --upgrade
        if [ $? -eq 0 ]; then
            echo "‚úÖ pip —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
        else
            echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ pip"
            exit 1
        fi
    else
        echo "‚ùå pip –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
        exit 1
    fi
fi

echo "‚úÖ pip –Ω–∞–π–¥–µ–Ω"

# –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
echo ""
echo "üîß –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
echo "üí° –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏–∑–æ–ª–∏—Ä—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞"
echo "üí° –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å –¥—Ä—É–≥–∏–º–∏ Python –ø—Ä–æ–µ–∫—Ç–∞–º–∏"
echo ""
read -p "–°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ? (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) (y/n): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "üîß –°–æ–∑–¥–∞—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
    python3 -m venv venv
    echo "‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ"
    
    # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
    source venv/bin/activate
    echo "‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ"
else
    echo "‚ö†Ô∏è  –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–æ"
    echo "üí° –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ"
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo ""
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Python..."
pip3 install -r requirements.txt

if [ $? -eq 0 ]; then
    echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
    exit 1
fi

# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x calendar_slots.py
chmod +x move_to_desktop.sh

echo ""
echo "üéâ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""

# –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–æ–∑–¥–∞—Ç—å —è—Ä–ª—ã–∫ –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ
echo "üñ•Ô∏è  –°–æ–∑–¥–∞–Ω–∏–µ —è—Ä–ª—ã–∫–∞ –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ"
echo "üí° –Ø—Ä–ª—ã–∫ –ø–æ–∑–≤–æ–ª–∏—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å Calendar Slots –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º"
echo "üí° –û–Ω –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã"
echo ""
read -p "–°–æ–∑–¥–∞—Ç—å —è—Ä–ª—ã–∫ –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ? (y/n): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo ""
    echo "üîß –°–æ–∑–¥–∞—é —è—Ä–ª—ã–∫ –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ..."
    ./move_to_desktop.sh
else
    echo ""
    echo "üìñ –Ø—Ä–ª—ã–∫ –Ω–µ —Å–æ–∑–¥–∞–Ω. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
    echo "   python3 calendar_slots.py"
    echo ""
    echo "üí° –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —è—Ä–ª—ã–∫ –ø–æ–∑–∂–µ, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
    echo "   ./move_to_desktop.sh"
fi

echo ""
echo "üéä –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! Calendar Slots –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!"
echo ""
echo "üìö –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "   python3 calendar_slots.py              # –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫"
echo "   python3 calendar_slots.py --verbose    # –ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–µ–∂–∏–º"
echo "   python3 calendar_slots.py --help       # –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã"
echo ""
echo "üí° –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ macOS –∑–∞–ø—Ä–æ—Å–∏—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—é"
echo "üí° –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞"
echo ""
echo "üöÄ –ì–æ—Ç–æ–≤–æ! –ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!" 